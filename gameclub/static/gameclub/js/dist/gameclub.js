const BASE_URL="https://app3774.acapp.acwing.com.cn";function refresh_tokens(){setInterval((()=>{$.ajax({url:`${BASE_URL}/gameclub/auth/jwt/token/refresh/`,type:"POST",data:{refresh:localStorage.getItem("gc-refresh")},success:i=>{localStorage.setItem("gc-access",i.access)}})}),27e4)}function clear_tokens(){localStorage.setItem("gc-access",""),localStorage.setItem("gc-refresh","")}function hexFromRGB(i,e,s){var t=[parseInt(i).toString(16),parseInt(e).toString(16),parseInt(s).toString(16)];return $.each(t,(function(i,e){1===e.length&&(t[i]="0"+e)})),t.join("").toUpperCase()}export class GameClubBind{constructor(i,e,s){this.id=i,this.os=e,this.email=s,this.$root_div=$("#"+i),this.$gc_forget=$('\n<div class="gc-index-back"></div>\n<div class="gc-index-forget-box-wrap">\n    <section class="gc-index-forget-box-email-section">\n       <div class="gc-index-forget-box-title">\n            输入账号\n       </div>\n       <div class="gc-index-forget-box-sub-title">\n            请输入要重置密码的邮箱账号\n       </div>\n       <div class="gc-index-forget-box-email">\n            <input type="email" placeholder = "请输入邮箱">\n       </div>\n       <div class="gc-index-forget-box-next-validate">\n            <button>下一步</button>\n       </div>\n    </section>\n    <section class="gc-index-forget-box-validate-section">\n        <div class="gc-index-forget-box-title">\n            验证邮箱\n       </div>\n       <div class="gc-index-forget-box-sub-title">\n       </div>\n       <div class="gc-index-forget-box-validate">\n            <input type="text" placeholder = "请输入验证码">\n            <div class="gc-index-forget-box-send">\n            <button class="gc-index-forget-box-send-button">\n                <span>发送验证码</span>\n            </button>\n            </div>\n       </div>\n       <div class="gc-index-forget-box-message">\n       </div>\n       <div class="gc-index-forget-box-next-change">\n            <button>完成</button>\n       </div>\n    </section>\n</div>\n'),this.$gc_forget_email=this.$gc_forget.find(".gc-index-forget-box-email-section"),this.$gc_forget_validate=this.$gc_forget.find(".gc-index-forget-box-validate-section"),this.$gc_forget_validate.hide(),this.$root_div.append(this.$gc_forget),this.start()}start(){if(this.$email_input=this.$gc_forget_email.find(".gc-index-forget-box-email > input"),this.$next_to_validate=this.$gc_forget_email.find(".gc-index-forget-box-next-validate > button"),this.$validate_input=this.$gc_forget_validate.find(".gc-index-forget-box-validate > input"),this.$next_to_change=this.$gc_forget_validate.find(".gc-index-forget-box-next-change > button"),this.$send_email=this.$gc_forget_validate.find(".gc-index-forget-box-send-button"),this.$error_message2=this.$gc_forget_validate.find(".gc-index-forget-box-message"),this.email){this.$gc_forget_email.find(".gc-index-forget-box-email > input").val(this.email)}this.add_listening_events()}add_listening_events(){this.$gc_forget_email.keydown((i=>{13===i.which&&this.$next_to_validate.click()})),this.$gc_forget_validate.keydown((i=>{13===i.which&&this.$next_to_change.click()})),this.$next_to_validate.on("click",(()=>{if(this.check_email()){this.$gc_forget_email.hide(),this.$gc_forget_validate.show(),this.$gc_forget_validate.find(".gc-index-forget-box-sub-title").text("点击获取验证码，验证码将发送至邮箱"+this.email)}else this.$email_input.css("border","1px solid red"),setTimeout((()=>{this.$email_input.css("border","1px solid #dcdee2")}),500)})),this.$next_to_change.on("click",(()=>{this.check_confirm()?this.change_email(this.$validate_input.val()):(this.$validate_input.css("border","1px solid red"),setTimeout((()=>{this.$validate_input.css("border","1px solid #dcdee2")}),500))})),this.$send_email.on("click",(()=>{this.send_email(this.email)}))}send_email(i){$.ajax({url:`${BASE_URL}/gameclub/auth/send_email/`,type:"post",data:{email:i,change:"false"},success:i=>{"success"===i.result?this.change_send_button():this.show_error_message(i.result)}})}change_send_button(){this.$span_text=this.$send_email.find("span");let i=60;this.$send_email.attr("disabled",!0),this.$span_text.text("重新发送("+i+"s)");let e=setInterval((()=>{i-=1,this.$span_text.text("重新发送("+i+"s)")}),1e3);setTimeout((()=>{clearInterval(e),this.$send_email.attr("disabled",!1),this.$span_text.text("发送验证码")}),6e4)}change_email(i){$.ajax({url:`${BASE_URL}/gameclub/auth/change/`,type:"post",data:{type:"email",email:this.email,validate:i},headers:{Authorization:"Bearer "+localStorage.getItem("gc-access")},success:i=>{"success"===i.result?window.location.href=`${BASE_URL}/`:this.show_error_message(i.result)}})}check_confirm(){return""!==this.$validate_input.val()}show_error_message(i){this.$error_message2.text(i),this.$error_message2.show(),setTimeout((()=>{this.$error_message2.hide()}),1e3)}check_email(){const i=this.$email_input.val();return-1!==i.search("@")&&(""!==i&&(this.email=i,!0))}}export class GameClubForget{constructor(i,e,s){this.id=i,this.os=e,this.email=s,this.$root_div=$("#"+i),this.$gc_forget=$('\n<div class="gc-index-back"></div>\n<div class="gc-index-forget-box-wrap">\n    <section class="gc-index-forget-box-email-section">\n       <div class="gc-index-forget-box-title">\n            输入账号\n       </div>\n       <div class="gc-index-forget-box-sub-title">\n            请输入要重置密码的邮箱账号\n       </div>\n       <div class="gc-index-forget-box-email">\n            <input type="email" placeholder = "请输入邮箱">\n       </div>\n       <div class="gc-index-forget-box-next-validate">\n            <button>下一步</button>\n       </div>\n    </section>\n    <section class="gc-index-forget-box-validate-section">\n        <div class="gc-index-forget-box-title">\n            验证邮箱\n       </div>\n       <div class="gc-index-forget-box-sub-title">\n       </div>\n       <div class="gc-index-forget-box-validate">\n            <input type="text" placeholder = "请输入验证码">\n            <div class="gc-index-forget-box-send">\n            <button class="gc-index-forget-box-send-button">\n                <span>发送验证码</span>\n            </button>\n            </div>\n       </div>\n       <div class="gc-index-forget-box-message">\n       </div>\n       <div class="gc-index-forget-box-next-change">\n            <button>下一步</button>\n       </div>\n    </section>\n    <section class="gc-index-forget-box-change-section">\n        <div class="gc-index-forget-box-title">\n            设置密码\n       </div>\n       <div class="gc-index-forget-box-change">\n            <input type="password" placeholder = "请输入密码">\n       </div>\n       <div class="gc-index-forget-box-change-confirm">\n            <input type="password" placeholder = "请再次输入密码">\n       </div>\n       <div class="gc-index-forget-box-message">\n       </div>\n       <div class="gc-index-forget-box-next-complete">\n            <button>修改密码</button>\n       </div>\n    </section>\n</div>\n'),this.$gc_forget_email=this.$gc_forget.find(".gc-index-forget-box-email-section"),this.$gc_forget_validate=this.$gc_forget.find(".gc-index-forget-box-validate-section"),this.$gc_forget_change=this.$gc_forget.find(".gc-index-forget-box-change-section"),this.$gc_forget_validate.hide(),this.$gc_forget_change.hide(),this.$root_div.append(this.$gc_forget),this.start()}start(){if(this.$email_input=this.$gc_forget_email.find(".gc-index-forget-box-email > input"),this.$next_to_validate=this.$gc_forget_email.find(".gc-index-forget-box-next-validate > button"),this.$validate_input=this.$gc_forget_validate.find(".gc-index-forget-box-validate > input"),this.$next_to_change=this.$gc_forget_validate.find(".gc-index-forget-box-next-change > button"),this.$send_email=this.$gc_forget_validate.find(".gc-index-forget-box-send-button"),this.$password_input=this.$gc_forget_change.find(".gc-index-forget-box-change > input"),this.$password_confirm_input=this.$gc_forget_change.find(".gc-index-forget-box-change-confirm > input"),this.$next_to_complete=this.$gc_forget_change.find(".gc-index-forget-box-next-complete"),this.$error_message=this.$gc_forget_change.find(".gc-index-forget-box-message"),this.$error_message2=this.$gc_forget_validate.find(".gc-index-forget-box-message"),this.email){this.$gc_forget_email.find(".gc-index-forget-box-email > input").val(this.email)}this.add_listening_events()}add_listening_events(){this.$gc_forget_email.keydown((i=>{13===i.which&&this.$next_to_validate.click()})),this.$gc_forget_validate.keydown((i=>{13===i.which&&this.$next_to_change.click()})),this.$gc_forget_change.keydown((i=>{13===i.which&&this.$next_to_complete.click()})),this.$next_to_validate.on("click",(()=>{if(this.check_email()){this.$gc_forget_email.hide(),this.$gc_forget_validate.show(),this.$gc_forget_validate.find(".gc-index-forget-box-sub-title").text("点击获取验证码，验证码将发送至邮箱"+this.email)}else this.$email_input.css("border","1px solid red"),setTimeout((()=>{this.$email_input.css("border","1px solid #dcdee2")}),500)})),this.$next_to_change.on("click",(()=>{this.check_confirm()?(this.$gc_forget_validate.hide(),this.$gc_forget_change.show()):(this.$validate_input.css("border","1px solid red"),setTimeout((()=>{this.$validate_input.css("border","1px solid #dcdee2")}),500))})),this.$next_to_complete.on("click",(()=>{this.check_password()?this.change_password(this.$validate_input.val(),this.$password_input.val()):(this.$password_input.css("border","1px solid red"),this.$password_confirm_input.css("border","1px solid red"),setTimeout((()=>{this.$password_input.css("border","1px solid #dcdee2"),this.$password_confirm_input.css("border","1px solid #dcdee2")}),500))})),this.$send_email.on("click",(()=>{this.send_email(this.email)}))}send_email(i){$.ajax({url:`${BASE_URL}/gameclub/auth/send_email/`,type:"post",data:{email:i,change:"true"},success:i=>{"success"===i.result?this.change_send_button():this.show_error_message(i.result,"2")}})}change_send_button(){this.$span_text=this.$send_email.find("span");let i=60;this.$send_email.attr("disabled",!0),this.$span_text.text("重新发送("+i+"s)");let e=setInterval((()=>{i-=1,this.$span_text.text("重新发送("+i+"s)")}),1e3);setTimeout((()=>{clearInterval(e),this.$send_email.attr("disabled",!1),this.$span_text.text("发送验证码")}),6e4)}change_password(i,e){$.ajax({url:`${BASE_URL}/gameclub/auth/change_password/`,type:"post",data:{email:this.email,validate:i,password:e},success:i=>{"success"===i.result?window.location.href=`${BASE_URL}/`:this.show_error_message(i.result,"1")}})}check_confirm(){return""!==this.$validate_input.val()}check_password(){const i=this.$password_input.val(),e=this.$password_confirm_input.val();return""!==i&&""!==e&&(i===e||(this.show_error_message("密码不一致","1"),!1))}show_error_message(i,e){"1"===e?(this.$error_message.text(i),this.$error_message.show(),setTimeout((()=>{this.$error_message.hide()}),1e3)):(this.$error_message2.text(i),this.$error_message2.show(),setTimeout((()=>{this.$error_message2.hide()}),1e3))}check_email(){const i=this.$email_input.val();return-1!==i.search("@")&&(""!==i&&(this.email=i,!0))}}export class GameClubSpan{constructor(i,e){this.id=i,this.os=e,this.$root_div=$("#"+this.id),this.$span_loading=$('\n<div class="wrapper">\n    <div class="rubik-loader"></div>\n</div>\n'),this.$span_div=$("\n<div class=\"gc-home-span\">\n    <section class=\"gc-home-span-top\">\n        <div class='gc-home-span-top-title'>\n        </div>\n        <div class='gc-home-span-top-opacity'>\n            <img src='/static/gameclub/images/home/O.svg' id='O'>\n            <img src='/static/gameclub/images/home/O1.svg' id='O1' style='display:none'>\n        </div>\n        <div class='gc-home-span-top-profile'>\n            <div class='gc-home-span-top-profile-name'>\n\n            </div>\n            <div class='gc-home-span-top-profile-photo'>\n                <img width='30' height='30' src=''>\n            </div>\n        </div>\n        <div class='gc-home-span-top-setting'>\n            <div class='gc-home-span-top-setting-img'><img src='/static/gameclub/images/home/setting.svg'>\n            </div>\n            <div class='gc-home-span-top-setting-title'>设置</div>\n        </div>\n        <div class=\"gc-home-span-top-signout\">\n            <button>退出</button>\n        </div>\n    </section>\n    <div class='gc-home-span-page-setting'>\n        <div class='opacity'>\n            <div class='setting-title'> 背景透明度 </div>\n            <div id='opacityslider'> </div>\n        </div>\n        <div class='color'>\n            <div class='setting-title'> 字体颜色 </div>\n            <div id=\"red\"></div>\n            <div id=\"green\"></div>\n            <div id=\"blue\"></div>\n        </div>\n        <div class='button'>\n            <button id='enter'> 确定 </button>\n            <button id='cancel'> 取消 </button>\n        </div>\n    </div>\n    <section class='gc-home-span-game'>\n        <section class='gc-home-span-game-div'>\n            <div class='gc-home-span-game-title'>\n                全部游戏\n            </div>\n            <div class='gc-home-span-game-list' id='game-list'>\n            </div>\n        </section>\n        <section class='gc-home-span-game-div'>\n            <div class='gc-home-span-game-title'>\n                最近游玩\n            </div>\n            <div class='gc-home-span-game-list' id='game-play'>\n            </div>\n        </section>\n    </section>\n</div>\n"),this.$span_div.hide(),this.$root_div.append(this.$span_div),this.$root_div.append(this.$span_loading),this.$span_top=this.$span_div.find(".gc-home-span-top"),this.$span_title=this.$span_div.find(".gc-home-span-top-title"),this.$span_profile=this.$span_div.find(".gc-home-span-top-profile"),this.$span_setting=this.$span_div.find(".gc-home-span-top-setting"),this.$span_signout=this.$span_div.find(".gc-home-span-top-signout > button"),this.$span_op=this.$span_div.find(".gc-home-span-top-opacity"),this.$span_game_all=this.$span_div.find("#game-list"),this.$span_game_play=this.$span_div.find("#game-play"),this.$span_page_setting=this.$span_div.find(".gc-home-span-page-setting"),this.setting=new GameClubSetting(this),this.start()}start(){setTimeout((()=>{this.$span_loading.fadeOut(),this.$span_div.fadeIn()}),500),this.get_info(),this.add_listening_events()}get_element(i){let e=i.name,s=i.types,t=i.photo,n=i.url,a=$(`\n<div class='gc-home-game-element'>\n    <a href='${n}' target='_blank'>\n    <div class='gc-home-game-element-top'>\n        <div class='gc-home-game-element-photo'>\n            <img src=''>\n        </div>\n        <div class='gc-home-game-element-title'>\n        </div>\n    </div>\n    <div class='gc-home-game-element-types'>\n    </div>\n    <div class='gc-home-game-element-date'>\n    </div>\n</div>\n`);if(a.find(".gc-home-game-element-photo > img").attr("src",t),a.find(".gc-home-game-element-title").text(e),""!==s){let i=s.split(",");for(let e=0;e<i.length;e++){let s=$("\n<div class='gc-home-game-element-type'> </div>\n");s.text(i[e]),a.find(".gc-home-game-element-types").append(s)}}return i.last_date&&a.find(".gc-home-game-element-date").text("最近游玩: "+i.last_date),a}load_setting(){console.log(`${this.user_id}-setting`),console.log(localStorage.getItem(`${this.user_id}-setting`));let i=localStorage.getItem(`${this.user_id}-setting`);if(i)this.setting_json=JSON.parse(i);else{this.setting_json={opacity:0,rgb:"255,182,193"};let i=JSON.stringify(this.setting_json);localStorage.setItem(`${this.user_id}-setting`,i)}console.log(`${this.user_id}-setting`),console.log(localStorage.getItem(`${this.user_id}-setting`))}save_setting(){let i=JSON.stringify(this.setting_json);localStorage.setItem(`${this.user_id}-setting`,i)}get_setting(i){return this.setting_json[i]}set_setting(i,e){this.setting_json[i]=e}add_widget(){let i=this;$("#opacityslider").slider({value:i.get_setting("opacity"),min:0,max:1,step:.01,range:"min",slide:()=>{let e=$("#opacityslider").slider("value");i.set_setting("opacity",e),i.set_back()},change:()=>{let e=$("#opacityslider").slider("value");i.set_setting("opacity",e),i.set_back()}}),$("#red, #green, #blue").slider({orientation:"horizontal",range:"min",max:255,value:127,slide:()=>{var e=$("#red").slider("value"),s=$("#green").slider("value"),t=$("#blue").slider("value");i.set_setting("rgb",e+","+s+","+t),i.set_color(!0)},change:()=>{var e=$("#red").slider("value"),s=$("#green").slider("value"),t=$("#blue").slider("value");i.set_setting("rgb",e+","+s+","+t),i.set_color(!0)}});let e=this.get_setting("rgb").split(","),s=e[0],t=e[1],n=e[2];$("#red").slider("value",s),$("#green").slider("value",t),$("#blue").slider("value",n)}add_listening_events(){this.$span_signout.on("click",(()=>{clear_tokens(),window.location.href=`${BASE_URL}/`})),this.$span_op.on("mouseenter",(()=>{this.$span_op.find("#O").hide(),this.$span_op.find("#O1").show()})).on("mouseleave",(()=>{this.$span_op.find("#O1").hide(),this.$span_op.find("#O").show()})),this.$span_op.on("click",(()=>{this.$span_page_setting.addClass("gc-home-setting-flex")})),this.$span_page_setting.find("#enter").on("click",(()=>{this.$span_op.find("#O1").hide(),this.$span_op.find("#O").show(),this.$span_page_setting.removeClass("gc-home-setting-flex"),this.save_setting()})),this.$span_page_setting.find("#cancel").on("click",(()=>{this.$span_op.find("#O1").hide(),this.$span_op.find("#O").show(),this.$span_page_setting.removeClass("gc-home-setting-flex")})),this.$span_profile.find("img").on("click",(()=>{window.open(this.photo,"_blank")})),this.$span_setting.on("click",(()=>{this.setting.show()}))}set_back(){let i=this.get_setting("opacity");this.$span_div.css("background","linear-gradient(rgba(0, 0, 0, "+i+"), rgba(0, 0, 0, "+i+")), url("+this.back+") repeat 0% 20%/ cover")}set_color(i){let e=this.get_setting("rgb").split(","),s="#"+hexFromRGB(e[0],e[1],e[2]);this.$span_div.css("color",s),i&&this.$span_div.find(".gc-home-game-element").css("background",s+"80")}padding_info(i){this.name=i.name,this.back=i.back,this.photo=i.photo,this.email=i.email,this.user_id=i.user_id,this.load_setting(),this.set_back(),this.set_color(!1),this.add_widget(),this.$span_profile.find(".gc-home-span-top-profile-name").text(i.name),this.$span_profile.find("img").attr("src",i.photo),this.$span_title.text(i.name.toUpperCase()+"'  个人空间"),this.$span_title.addClass("gc-home-span-top-title-trans"),this.padding_game(i.game_list,i.game_play),this.setting.padding_info()}padding_game(i,e){i&&i.forEach(((i,e,s)=>{this.$span_game_all.append(this.get_element(i))})),e&&e.forEach(((i,e,s)=>{this.$span_game_play.append(this.get_element(i))})),this.set_color(!0)}get_info(){$.ajax({url:`${BASE_URL}/gameclub/auth/get_info/`,type:"post",headers:{Authorization:"Bearer "+localStorage.getItem("gc-access")},success:i=>{refresh_tokens(),this.padding_info(i)},error:()=>{window.location.href=`${BASE_URL}/`}})}}class GameClubIndexBack{constructor(i){this.root=i,this.$back=$('<div class="gc-index-back"></div>'),this.root.$gc_index.append(this.$back),this.start()}start(){}}class GameClubIndexLogin{constructor(i){this.root=i,this.$login_box=$(`\n<div class="gc-index-login-box-wrap">\n<div class="gc-index-login-box-img">\n    <img src="${BASE_URL}/static/gameclub/images/index/hakase.jpg">\n</div>\n<div class="gc-index-login-box">\n    <div class="gc-index-login-box-title">\n        登录 GameClub\n    </div>\n    <div class="gc-index-login-box-form">\n        <div class="gc-index-login-box-email">\n            <div class="gc-index-login-box-email-logo">\n                <img src="${BASE_URL}/static/gameclub/images/index/email.svg">\n            </div>\n            <div class="gc-index-login-box-email-input">\n                <input type='email' placeholder="邮箱">\n            </div>\n        </div>\n        <div class="gc-index-login-box-password">\n            <div class="gc-index-login-box-passwd-logo">\n                <img src="${BASE_URL}/static/gameclub/images/index/passwd.svg">\n            </div>\n            <div class="gc-index-login-box-passwd-input">\n                <input type='password' placeholder="密码">\n            </div>\n        </div>\n        <div class="gc-index-login-box-message">\n            用户名或密码错误\n        </div>\n        <div class="gc-index-login-box-login-button">\n            <button>登录</button>\n        </div>\n    </div>\n    <div class="gc-index-login-box-other">\n        <div class="gc-index-login-box-other-register">\n            注册\n        </div>\n        <div class="gc-index-login-box-other-line">\n            |\n        </div>\n        <div class="gc-index-login-box-other-forget">\n            忘记密码?\n        </div>\n    </div>\n    <div class="gc-index-login-box-third">\n        <div class="gc-index-login-box-third-logo">\n            <img width="30" height="30" src="${BASE_URL}/static/gameclub/images/index/acapp.jpg">\n        </div>\n    </div>\n\n</div>\n</div>\n`),this.$login_box.hide(),this.root.$gc_index.append(this.$login_box),this.start()}start(){this.$email_box=this.$login_box.find(".gc-index-login-box-email"),this.$email_input=this.$email_box.find("input"),this.$password_box=this.$login_box.find(".gc-index-login-box-password"),this.$password_input=this.$password_box.find("input"),this.$login_button=this.$login_box.find(".gc-index-login-box-login-button > button"),this.$register_div=this.$login_box.find(".gc-index-login-box-other-register"),this.$forget_div=this.$login_box.find(".gc-index-login-box-other-forget"),this.$acwing_div=this.$login_box.find(".gc-index-login-box-third-logo"),this.$error_message=this.$login_box.find(".gc-index-login-box-message"),this.add_listening_events(),this.to_span()}add_listening_events(){this.$email_input.focus((()=>{this.email_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$password_input.focus((()=>{this.password_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$login_button.on("click",(()=>{clear_tokens(),this.login()})),this.$register_div.on("click",(()=>{window.location.href=`${BASE_URL}/gameclub/page/register`})),this.$forget_div.on("click",(()=>{""===this.$email_input.val()?window.location.href=`${BASE_URL}/gameclub/page/forget/`:window.location.href=`${BASE_URL}/gameclub/page/forget/?email=`+this.$email_input.val()})),this.$acwing_div.on("click",(()=>{clear_tokens(),this.acwing_login()})),this.$login_box.keydown((i=>{13===i.which&&this.$login_button.click()}))}acwing_login(){$.ajax({url:`${BASE_URL}/gameclub/auth/third_login/acwing/apply_code/`,type:"get",success:i=>{"success"===i.result&&(window.location.href=i.url)}})}login(){const i=this.$email_input.val(),e=this.$password_input.val();return""===i?(this.email_error_focus(!0),this.$email_input.attr("placeholder","邮箱为空"),void this.$email_input.addClass("gc-index-input-change")):""===e?(this.password_error_focus(!0),this.$password_input.attr("placeholder","密码为空"),void this.$password_input.addClass("gc-index-input-change")):void $.ajax({url:`${BASE_URL}/gameclub/auth/jwt/token/`,type:"post",data:{username:i,password:e},success:i=>{localStorage.setItem("gc-access",i.access),localStorage.setItem("gc-refresh",i.refresh),this.to_span()},error:()=>{this.password_error_focus(!0,!1),this.email_error_focus(!0,!1),this.$password_input.addClass("gc-index-input-change"),this.$email_input.addClass("gc-index-input-change"),this.$error_message.show()}})}password_error_focus(i,e){e&&this.clear_email_password(),i?this.$password_box.addClass("gc-index-login-box-input-error"):this.$password_box.addClass("gc-index-login-box-input-focus")}clear_email_password(){this.$email_box.hasClass("gc-index-login-box-input-error")&&this.$email_box.removeClass("gc-index-login-box-input-error"),this.$email_box.hasClass("gc-index-login-box-input-focus")&&this.$email_box.removeClass("gc-index-login-box-input-error"),this.$email_box.hasClass("gc-index-login-box-input-focus")&&this.$email_box.removeClass("gc-index-login-box-input-focus"),this.$password_box.hasClass("gc-index-login-box-input-error")&&this.$password_box.removeClass("gc-index-login-box-input-error"),this.$password_box.hasClass("gc-index-login-box-input-focus")&&this.$password_box.removeClass("gc-index-login-box-input-focus"),this.$email_input.hasClass("gc-index-input-change")&&this.$email_input.removeClass("gc-index-input-change"),this.$password_input.hasClass("gc-index-input-change")&&this.$password_input.removeClass("gc-index-input-change"),this.$email_input.attr("placeholder","邮箱"),this.$password_input.attr("placeholder","密码"),this.$error_message.hide()}email_error_focus(i,e){e&&this.clear_email_password(),i?this.$email_box.addClass("gc-index-login-box-input-error"):this.$email_box.addClass("gc-index-login-box-input-focus")}to_span(){$.ajax({url:`${BASE_URL}/gameclub/auth/check/`,type:"post",headers:{Authorization:"Bearer "+localStorage.getItem("gc-access")},success:i=>{""!==this.root.redirect?window.location.href=this.root.redirect:window.location.href=`${BASE_URL}/gameclub/page/span/`},error:()=>{this.$login_box.show()}})}}export class GameClubIndex{constructor(i,e,s,t,n){this.id=i,this.os=e,this.redirect=n,localStorage.getItem("gc-access")||localStorage.setItem("gc-access",s),localStorage.getItem("gc-refresh")||localStorage.setItem("gc-refresh",t),this.$gc_index=$("\n<div class='gc-index'>\n</div>\n"),this.$root_div=$("#"+i),this.$root_div.append(this.$gc_index),this.start()}start(){this.back=new GameClubIndexBack(this),this.login_box=new GameClubIndexLogin(this)}}export class GameClubRegister{constructor(i,e){this.id=i,this.os=e,this.$root_div=$("#"+i),this.$gc_register=$(`\n<div class="gc-index-back"></div>\n<div class="gc-index-register-wrap">\n    <div class="gc-index-register-box">\n        <div class="gc-index-register-title">欢迎注册 GameClub</div>\n        <div class="gc-index-register-box-form">\n            <div class="gc-index-register-box-name">\n                <div class="gc-index-register-box-name-logo">\n                    <img src="${BASE_URL}/static/gameclub/images/register/name.svg">\n                </div>\n                <div class="gc-index-register-box-name-input">\n                    <input type='text' placeholder="昵称">\n                </div>\n            </div>\n            <div class="gc-index-register-box-email">\n                <div class="gc-index-register-box-email-logo">\n                    <img src="${BASE_URL}/static/gameclub/images/index/email.svg">\n                </div>\n                <div class="gc-index-register-box-email-input">\n                    <input type='email' placeholder="邮箱">\n                </div>\n            </div>\n\n            <div class="gc-index-register-box-password">\n                <div class="gc-index-register-box-password-logo">\n                    <img src="${BASE_URL}/static/gameclub/images/index/passwd.svg">\n                </div>\n                <div class="gc-index-register-box-password-input">\n                    <input type='password' placeholder="密码">\n                </div>\n            </div>\n\n            <div class="gc-index-register-box-password-confirm">\n                <div class="gc-index-register-box-password-confirm-logo">\n                    <img src="${BASE_URL}/static/gameclub/images/index/passwd.svg">\n                </div>\n                <div class="gc-index-register-box-password-confirm-input">\n                    <input type='password' placeholder="再次输入密码">\n                </div>\n            </div>\n\n            <div class="gc-index-register-box-confirm-email">\n                <div class="gc-index-register-box-confirm-email-logo">\n                    <img src="${BASE_URL}/static/gameclub/images/register/confirm.svg">\n                </div>\n                <div class="gc-index-register-box-confirm-email-input">\n                    <input type='text' placeholder="输入验证码">\n                </div>\n                <div class="gc-index-register-box-confirm-email-send">\n                    <button>发送验证码</button>\n                </div>\n            </div>\n            <div class="gc-index-register-box-message"></div>\n            <div class="gc-index-register-box-register-button">\n                <button>立即注册</button>\n            </div>\n        </div>\n        <div class="gc-index-register-box-other">\n            <div class="gc-index-register-box-other-login">\n                登录\n            </div>\n            <div class="gc-index-register-box-other-line">\n                |\n            </div>\n            <div class="gc-index-register-box-other-forget">\n                忘记密码?\n            </div>\n        </div>\n    </div>\n</div>\n`),this.$root_div.append(this.$gc_register),this.start()}start(){this.$name_box=this.$gc_register.find(".gc-index-register-box-name"),this.$name_input=this.$gc_register.find(".gc-index-register-box-name-input > input"),this.$email_box=this.$gc_register.find(".gc-index-register-box-email"),this.$email_input=this.$gc_register.find(".gc-index-register-box-email-input > input"),this.$password_box=this.$gc_register.find(".gc-index-register-box-password"),this.$password_input=this.$gc_register.find(".gc-index-register-box-password-input > input"),this.$password_confirm_box=this.$gc_register.find(".gc-index-register-box-password-confirm"),this.$password_confirm_input=this.$gc_register.find(".gc-index-register-box-password-confirm-input > input"),this.$confirm_email_box=this.$gc_register.find(".gc-index-register-box-confirm-email"),this.$confirm_email_input=this.$gc_register.find(".gc-index-register-box-confirm-email-input > input"),this.$confirm_email_send=this.$gc_register.find(".gc-index-register-box-confirm-email-send > button"),this.$register_button=this.$gc_register.find(".gc-index-register-box-register-button"),this.$other_login=this.$gc_register.find(".gc-index-register-box-other-login"),this.$other_forget=this.$gc_register.find(".gc-index-register-box-other-forget"),this.$error_message=this.$gc_register.find(".gc-index-register-box-message"),this.$register_box=this.$gc_register.find(".gc-index-register-box"),this.add_listening_events()}add_listening_events(){this.$name_input.focus((()=>{this.name_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$email_input.focus((()=>{this.email_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$password_input.focus((()=>{this.password_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$password_confirm_input.focus((()=>{this.password_confirm_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$confirm_email_input.focus((()=>{this.confirm_email_error_focus(!1,!0)})).blur((()=>{this.clear_email_password()})),this.$register_button.on("click",(()=>{this.register()})),this.$other_login.on("click",(()=>{window.location.href=`${BASE_URL}/`})),this.$other_forget.on("click",(()=>{window.location.href=`${BASE_URL}/gameclub/page/forget/`})),this.$confirm_email_send.on("click",(()=>{this.send()})),this.$register_box.keydown((i=>{13===i.which&&this.$register_button.click()}))}register(){const i=this.$name_input.val(),e=this.$email_input.val(),s=this.$password_input.val(),t=this.$password_confirm_input.val(),n=this.$confirm_email_input.val();return""===i?(this.name_error_focus(!0,!0),this.$name_input.attr("placeholder","请填入昵称"),void this.$name_input.addClass("gc-index-input-change")):""===e?(this.email_error_focus(!0,!0),this.$email_input.attr("placeholder","请填入邮箱"),void this.$email_input.addClass("gc-index-input-change")):-1===e.search("@")?(this.email_error_focus(!0,!0),this.$error_message.text("邮箱格式错误"),void this.$error_message.show()):""===s?(this.password_error_focus(!0,!0),this.$password_input.attr("placeholder","请填入密码"),void this.$email_input.addClass("gc-index-input-change")):""===t?(this.password_confirm_error_focus(!0,!0),this.$password_confirm_input.attr("placeholder","请再次填入密码"),void this.$password_confirm_input.addClass("gc-index-input-change")):""===n?(this.confirm_email_error_focus(!0,!0),this.$confirm_email_input.attr("placeholder","请填入验证码"),void this.$confirm_email_input.addClass("gc-index-input-change")):s!==t?(this.password_error_focus(!0,!0),this.password_confirm_error_focus(!0,!1),this.$error_message.text("密码不一致"),void this.$error_message.show()):void $.ajax({url:`${BASE_URL}/gameclub/auth/signup/`,type:"post",data:{name:i,email:e,password:s,confirm:n},success:i=>{"success"===i.result?window.location.href=i.url:(this.$error_message.val(i.result),this.$error_message.show())}})}send(){const i=this.$email_input.val();return""===i?(this.email_error_focus(!0,!0),this.$email_input.attr("placeholder","请填入邮箱"),void this.$email_input.addClass("gc-index-input-change")):-1===i.search("@")?(this.email_error_focus(!0,!0),this.$error_message.text("邮箱格式错误"),void this.$error_message.show()):void $.ajax({url:`${BASE_URL}/gameclub/auth/send_email/`,type:"post",data:{email:i,change:"false"},success:i=>{"success"===i.result?this.change_send_button():(this.email_error_focus(!0,!0),this.$error_message.val(i.result),this.$error_message.show())}})}change_send_button(){this.clear_email_password(),this.$confirm_email_send.attr("disabled",!0);let i=60;this.$confirm_email_send.text("重新发送("+i+"s)"),this.$confirm_email_send.css("cursor","not-allowed");let e=setInterval((()=>{i-=1,this.$confirm_email_send.text("重新发送("+i+"s)"),this.$confirm_email_send.css("cursor","not-allowed")}),1e3);setTimeout((()=>{clearInterval(e),this.$confirm_email_send.attr("disabled",!1),this.$confirm_email_send.text("发送验证码"),this.$confirm_email_send.css("cursor","pointer")}),6e4)}confirm_email_error_focus(i,e){e&&this.clear_email_password(),i?this.$confirm_email_box.addClass("gc-index-login-box-input-error"):this.$confirm_email_box.addClass("gc-index-login-box-input-focus")}name_error_focus(i,e){e&&this.clear_email_password(),i?this.$name_box.addClass("gc-index-login-box-input-error"):this.$name_box.addClass("gc-index-login-box-input-focus")}password_confirm_error_focus(i,e){e&&this.clear_email_password(),i?this.$password_confirm_box.addClass("gc-index-login-box-input-error"):this.$password_confirm_box.addClass("gc-index-login-box-input-focus")}password_error_focus(i,e){e&&this.clear_email_password(),i?this.$password_box.addClass("gc-index-login-box-input-error"):this.$password_box.addClass("gc-index-login-box-input-focus")}email_error_focus(i,e){e&&this.clear_email_password(),i?this.$email_box.addClass("gc-index-login-box-input-error"):this.$email_box.addClass("gc-index-login-box-input-focus")}clear_email_password(){this.$name_box.hasClass("gc-index-login-box-input-error")&&this.$name_box.removeClass("gc-index-login-box-input-error"),this.$name_box.hasClass("gc-index-login-box-input-focus")&&this.$name_box.removeClass("gc-index-login-box-input-focus"),this.$email_box.hasClass("gc-index-login-box-input-error")&&this.$email_box.removeClass("gc-index-login-box-input-error"),this.$email_box.hasClass("gc-index-login-box-input-focus")&&this.$email_box.removeClass("gc-index-login-box-input-focus"),this.$email_box.hasClass("gc-index-login-box-input-focus")&&this.$email_box.removeClass("gc-index-login-box-input-focus"),this.$password_box.hasClass("gc-index-login-box-input-error")&&this.$password_box.removeClass("gc-index-login-box-input-error"),this.$password_box.hasClass("gc-index-login-box-input-focus")&&this.$password_box.removeClass("gc-index-login-box-input-focus"),this.$password_confirm_box.hasClass("gc-index-login-box-input-focus")&&this.$password_confirm_box.removeClass("gc-index-login-box-input-focus"),this.$password_confirm_box.hasClass("gc-index-login-box-input-error")&&this.$password_confirm_box.removeClass("gc-index-login-box-input-error"),this.$confirm_email_box.hasClass("gc-index-login-box-input-focus")&&this.$confirm_email_box.removeClass("gc-index-login-box-input-focus"),this.$confirm_email_box.hasClass("gc-index-login-box-input-error")&&this.$confirm_email_box.removeClass("gc-index-login-box-input-error"),this.$email_input.hasClass("gc-index-input-change")&&this.$email_input.removeClass("gc-index-input-change"),this.$password_input.hasClass("gc-index-input-change")&&this.$password_input.removeClass("gc-index-input-change"),this.$password_confirm_input.hasClass("gc-index-input-change")&&this.$password_confirm_input.removeClass("gc-index-input-change"),this.$confirm_email_input.hasClass("gc-index-input-change")&&this.$confirm_email_input.removeClass("gc-index-input-change"),this.$name_input.hasClass("gc-index-input-change")&&this.$name_input.removeClass("gc-index-input-change"),this.$email_input.attr("placeholder","邮箱"),this.$password_input.attr("placeholder","密码"),this.$password_confirm_box.attr("placeholder","再次输入密码"),this.$confirm_email_input.attr("placeholder","输入验证码"),this.$name_input.attr("placeholder","昵称"),this.$error_message.hide()}}class GameClubSetting{constructor(i){this.root=i,this.$setting_page=$("\n<div class='gc-home-setting-page'>\n    <div class='gc-home-setting-div'>\n        <div class='gc-home-setting-top'>\n            <div class='gc-home-setting-title'>\n                设置\n            </div>\n            <div class='gc-home-setting-cancel'>\n                <img src='/static/gameclub/images/settings/cancel.svg'>\n            </div>\n        </div>\n        <div class='gc-home-setting-content'>\n            <div class='gc-home-setting-name'>\n                <span class='gc-home-setting-span'>昵称: </span>\n                <input type='text' disabled='true'>\n                <img src='/static/gameclub/images/settings/edit.svg'>\n                <button class='gc-home-setting-confirm disabled-click' id='name'>确定</button>\n                <button class='gc-home-setting-confirm disabled-click' id='name-cancel'>取消</button>\n            </div>\n            <div class='gc-home-setting-email'>\n                <span class='gc-home-setting-span'>邮箱: </span>\n                <div class='gc-home-setting-email-show'></div>\n                <button class='gc-home-setting-confirm' id='email'>绑定邮箱</button>\n                <button class='gc-home-setting-confirm' id='password'>更改密码</button>\n            </div>\n            <div class='gc-home-setting-photo'>\n                <span class='gc-home-setting-span'>头像: </span>\n                <img src=''>\n                <input type='file' name='photo' accept='image/*' style='display: none'>\n                <button class='gc-home-setting-confirm' id='photo'>上传头像</button>\n            </div>\n            <div class='gc-home-setting-back'>\n                <span class='gc-home-setting-span'>背景: </span>\n                <img src=''>\n                <input type='file' name='back' accept='image/*' style='display: none'>\n                <button class='gc-home-setting-confirm' id='back'>上传背景</button>\n            </div>\n        </div>\n    </div>\n</div>\n"),this.$error_message=$("\n<div class='gc-home-error-message'>\n</div>\n"),this.$success_message=$("\n<div class='gc-home-success-message'>\n</div>\n"),this.$setting_page.append(this.$error_message),this.$setting_page.append(this.$success_message),this.$setting_page.hide(),this.root.$root_div.append(this.$setting_page),this.$span_cancel=this.$setting_page.find(".gc-home-setting-cancel"),this.$span_name_input=this.$setting_page.find(".gc-home-setting-name > input"),this.$span_name_edit=this.$setting_page.find(".gc-home-setting-name > img"),this.$span_name_confirm=this.$setting_page.find("#name"),this.$span_name_cancel=this.$setting_page.find("#name-cancel"),this.$span_email_show=this.$setting_page.find(".gc-home-setting-email-show"),this.$span_email_change=this.$setting_page.find("#email"),this.$span_password_change=this.$setting_page.find("#password"),this.$span_photo_img=this.$setting_page.find(".gc-home-setting-photo > img"),this.$span_photo_input=this.$setting_page.find(".gc-home-setting-photo > input"),this.$span_photo_change=this.$setting_page.find("#photo"),this.$span_back_img=this.$setting_page.find(".gc-home-setting-back > img"),this.$span_back_input=this.$setting_page.find(".gc-home-setting-back > input"),this.$span_back_change=this.$setting_page.find("#back"),this.start()}start(){this.add_listening_events()}add_listening_events(){this.$span_cancel.on("click",(()=>{this.hide()})),this.$span_name_edit.on("click",(()=>{this.$span_name_edit.fadeOut(),this.$span_name_confirm.removeClass("disabled-click"),this.$span_name_cancel.removeClass("disabled-click"),this.$span_name_input.attr("disabled",!1)})),this.$span_name_confirm.on("click",(i=>{this.change_name(this.$span_name_input.val(),i)})),this.$span_name_cancel.on("click",(()=>{this.$span_name_input.attr("disabled",!0),this.$span_name_confirm.addClass("disabled-click"),this.$span_name_cancel.addClass("disabled-click"),this.$span_name_edit.fadeIn(),this.$span_name_input.val(this.root.name)})),this.$span_password_change.on("click",(()=>{window.location.href=`${BASE_URL}/gameclub/page/forget/?email=`+this.root.email})),this.$span_email_change.on("click",(()=>{window.location.href=`${BASE_URL}/gameclub/page/bind/`})),this.$span_photo_input.change((()=>{let i=this.$span_photo_change.offset().left,e=this.$span_photo_change.offset().top;this.change_file("photo",i,e)})),this.$span_back_input.change((()=>{let i=this.$span_back_change.offset().left,e=this.$span_back_change.offset().top;this.change_file("back",i,e)})),this.$span_photo_change.on("click",(()=>{this.$span_photo_input.click()})),this.$span_back_change.on("click",(()=>{this.$span_back_input.click()}))}get_error_message(i,e,s){this.$error_message.css("top",s+"px"),this.$error_message.css("left",e+"px"),this.$error_message.text(i),this.$error_message.show(),this.$error_message.animate({top:s-50+"px"},"normal","linear"),this.$error_message.fadeOut()}get_success_message(i,e,s){this.$success_message.css("top",s+"px"),this.$success_message.css("left",e+"px"),this.$success_message.text(i),this.$success_message.show(),this.$success_message.animate({top:s-50+"px"},"normal","linear"),this.$success_message.fadeOut()}change_file(i,e,s){let t=null;if("photo"===i){t=document.getElementsByName("photo")[0].files[0]}else if("back"===i){t=document.getElementsByName("back")[0].files[0]}let n=new FormData;n.append("type",i),n.append("file",t),$.ajax({url:`${BASE_URL}/gameclub/auth/change/`,type:"post",dataType:"json",processData:!1,contentType:!1,data:n,headers:{Authorization:"Bearer "+localStorage.getItem("gc-access")},success:i=>{"success"===i.result?this.get_success_message("上传成功, 请刷新页面",e,s):this.get_error_message(i.result,e,s),this.$span_photo_input.value="",this.$span_back_input.value=""},error:()=>{this.get_error_message("上传失败, 请再次尝试",e,s),this.$span_photo_input.value="",this.$span_back_input.value=""}})}change_name(i,e){let s=e.clientX,t=e.clientY;$.ajax({url:`${BASE_URL}/gameclub/auth/change/`,type:"post",data:{type:"name",name:i},headers:{Authorization:"Bearer "+localStorage.getItem("gc-access")},success:i=>{this.$span_name_input.attr("disabled",!0),this.$span_name_confirm.addClass("disabled-click"),this.$span_name_cancel.addClass("disabled-click"),this.$span_name_edit.fadeIn(),this.get_success_message("修改成功",s,t)},error:()=>{this.get_error_message("修改失败, 请再次尝试",s,t)}})}padding_info(){this.$span_name_input.val(this.root.name),-1===this.root.email.search("@gameclub.net")?(this.$span_email_show.text(this.root.email),this.$span_email_change.addClass("disabled-click")):(this.$span_email_show.text("第三方登录, 无邮箱"),this.$span_password_change.addClass("disabled-click")),this.$span_photo_img.attr("src",this.root.photo),this.$span_back_img.attr("src",this.root.back)}show(){this.$setting_page.fadeIn()}hide(){this.$setting_page.fadeOut()}}
